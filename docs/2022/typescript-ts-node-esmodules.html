<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <meta name="twitter:card" content="summary" />
    <meta property="og:url" content="https://japanese-document.github.io/tips/2022/typescript-ts-node-esmodules.html" />
    <meta property="og:title" content="ts-nodeでESModulesを使う方法" />
    <meta property="og:description" content="NodeJSのバージョンが20で正常に動作しない場合はバージョン18を使う。設定下記の設定をします。package.jsonに&quot;type&quot;: &quot;module&quot;を加えます。tsconfig.jsonのcompilerOptions.moduleを&quot;NodeNext&quot;にします。tsconfig.jsonのts-nodeを次のようにします。{  ...  &quot;ts-node&quot;: {    &quot;esm&quot;: true,    &quot;require&quot;: [&quot;tsconfig-paths" />
    <meta property="og:image" content="https://avatars2.githubusercontent.com/u/42838312?s=400" />
    <meta name="theme-color" content="#f1f7fe" />
    <meta name="description" content="NodeJSのバージョンが20で正常に動作しない場合はバージョン18を使う。設定下記の設定をします。package.jsonに&quot;type&quot;: &quot;module&quot;を加えます。tsconfig.jsonのcompilerOptions.moduleを&quot;NodeNext&quot;にします。tsconfig.jsonのts-nodeを次のようにします。{  ...  &quot;ts-node&quot;: {    &quot;esm&quot;: true,    &quot;require&quot;: [&quot;tsconfig-paths" />
    <meta name="Hatena::Bookmark" content="nocomment" />
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://japanese-document.github.io/tips/rss.xml" />
    <link rel="icon" type="image/png" href="/lit/images/favicon.png" />
    <title>ts-nodeでESModulesを使う方法</title>
    <link rel="stylesheet" href="/tips/app.css?v=001" type="text/css"  media="all" />
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-L9VVC74WWF"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-L9VVC74WWF');
    </script>
  </head>
  <body class="container">
    <div class="left-side">
    <div class="index-menu">
      <details open="">
        <summary>CSS</summary>
        <p><a href="https://japanese-document.github.io/tips/2022/css-has-pseudo-class.html">特定の子要素を持つ要素を指定するCSSセレクタ</a></p>
        <p><a href="https://japanese-document.github.io/tips/2022/css-is-pseudo-class.html">CSSセレクタで共通の子要素を持つ親要素をまとめる</a></p>
        <p><a href="https://japanese-document.github.io/tips/2023/css-chrome-devtools-diff.html">Chrome Devtoolsで変更したCSSの差分を確認する</a></p>
      </details>
      <details open="">
        <summary>Git</summary>
        <p><a href="https://japanese-document.github.io/tips/2022/git-remove-branches-without-main.html">Gitでmainブランチ以外のブランチを削除する</a></p>
        <p><a href="https://japanese-document.github.io/tips/2022/git-alias.html">Gitでaliasを設定する</a></p>
      </details>
      <details open="">
        <summary>JavaScript</summary>
        <p><a href="https://japanese-document.github.io/tips/2022/javascript-first-line-from-string.html">JavaScriptで文字列から最初の1行を取得する</a></p>
        <p><a href="https://japanese-document.github.io/tips/2022/javascript-insert-items-to-array.html">JavaScriptで配列に値を挿入する</a></p>
        <p><a href="https://japanese-document.github.io/tips/2022/javascript-last-item-in-arrray.html">JavaScriptで配列の最後の値を取得する</a></p>
        <p><a href="https://japanese-document.github.io/tips/2022/javascript-marked.html">Marked</a></p>
        <p><a href="https://japanese-document.github.io/tips/2023/javascript-nodejs-promisify-function.html">JavaScript(NodeJS)でコールバック関数をPromise化する </a></p>
        <p><a href="https://japanese-document.github.io/tips/2023/javascript-react-or-next-web-application.html">ReactやNext.jsを使っているオープンソースのWebアプリケーション</a></p>
        <p><a href="https://japanese-document.github.io/tips/2023/javascript-string-replace-second-parameter.html">JavaScriptのString.replace()の第2引数の文字列をエスケープする</a></p>
        <p><a href="https://japanese-document.github.io/tips/2023/javascript-jest-mockclear-mockreset-mockrestore.html">JestのmockClear、mockReset、mockRestore</a></p>
        <p><a href="https://japanese-document.github.io/tips/2023/javascript-vue-web-application.html">Vueを使っているオープンソースのWebアプリケーション</a></p>
        <p><a href="https://japanese-document.github.io/tips/2023/javascript-nodejs-glob.html">NodeJSでパターンにマッチしたパスのリストを取得する方法</a></p>
      </details>
      <details open="">
        <summary>Python</summary>
        <p><a href="https://japanese-document.github.io/tips/2022/python-simple-server.html">PythonでWebサーバをたてるコマンド</a></p>
      </details>
      <details open="">
        <summary>AWS</summary>
        <p><a href="https://japanese-document.github.io/tips/2022/aws-cli-config.html">aws-cliの設定ファイルの例</a></p>
      </details>
      <details open="">
        <summary>TypeScript</summary>
        <p><a href="https://japanese-document.github.io/tips/2022/typescript-ts-node-esmodules.html">ts-nodeでESModulesを使う方法</a></p>
        <p><a href="https://japanese-document.github.io/tips/2022/typescript-dompurify-and-jsdom.html">TypeScriptでDOMPurifyとjsdomを使う方法</a></p>
        <p><a href="https://japanese-document.github.io/tips/2023/typescript-type-one-of-object-values.html">既存のObjectの値のうち1つが該当する型を定義する方法</a></p>
        <p><a href="https://japanese-document.github.io/tips/2023/typescript-type-from-array.html">配列から配列の各値のどれか１つに該当する型を生成する方法</a></p>
        <p><a href="https://japanese-document.github.io/tips/2023/typescript-generics-having-property.html">TypeScriptで特定のプロパティを持つジェネリクスを定義する方法</a></p>
        <p><a href="https://japanese-document.github.io/tips/2023/typescript-typing-value-by-pattern-property.html">プロパティの値の型をプロパティ名のパターン毎に定義する方法</a></p>
        <p><a href="https://japanese-document.github.io/tips/2023/typescript-jest-mock-module.html">TypeScriptでJestを使ってモジュールをモック(mock)する</a></p>
        <p><a href="https://japanese-document.github.io/tips/2023/typescript-union-property.html">objectとnullのUnion型のプロパティの型からnullを削除する</a></p>
        <p><a href="https://japanese-document.github.io/tips/2023/typescript-type-annotation-and-satisfies.html">Type AnnotationsとSatisfies Operatorの違い</a></p>
        <p><a href="https://japanese-document.github.io/tips/2023/typescript-integer-range-typing.html">TypeScriptで数値の範囲を指定する型を定義する</a></p>
      </details>
      <details open="">
        <summary>Go</summary>
        <p><a href="https://japanese-document.github.io/tips/2023/golang-slices-contains.html">Goで指定した値が配列内に存在するか判別する</a></p>
        <p><a href="https://japanese-document.github.io/tips/2023/golang-upgrade-version-ubuntu.html">UbuntuでGoのバージョンをアップグレードする方法</a></p>
      </details>
      <details open="">
        <summary>Ubuntu</summary>
        <p><a href="https://japanese-document.github.io/tips/2023/ubuntu-screenshot-area.html">Ubuntuで範囲を指定してスクリーンショットを撮る方法</a></p>
      </details>
      <details open="">
        <summary>React</summary>
        <p><a href="https://japanese-document.github.io/tips/2023/react-mui-button-cursor-not-allowed.html">CSSでMaterial UI(MUI)のボタンのカーソルをnot allowedにする</a></p>
        <p><a href="https://japanese-document.github.io/tips/2023/react-mui-typography-no-new-line.html">Material UI(MUI)のTypographyコンポーネントを改行させない方法</a></p>
        <p><a href="https://japanese-document.github.io/tips/2023/react-hook-form-useformcontext-return-null.html">React Hook FormのuseFormContextがnullを返す時の対処法</a></p>
        <p><a href="https://japanese-document.github.io/tips/2023/react-parent-change.html">Reactで親コンポーネントで子コンポーネントを変更する</a></p>
        <p><a href="https://japanese-document.github.io/tips/2023/react-testing-redux-toolkit-createasyncthunk.html">createAsyncThunk()で生成されたAsync Actionのテスト</a></p>
      </details>
    </div></div>
    <main class="main markdown-body">
      <h1 id="ts-nodeでESModulesを使う方法"><a href="#ts-nodeでESModulesを使う方法">ts-nodeでESModulesを使う方法</a></h1>
<p>NodeJSのバージョンが20で正常に動作しない場合はバージョン18を使う。</p>
<h2 id="設定"><a href="#設定">設定</a></h2>
<p>下記の設定をします。</p>
<ul>
<li><p><code>package.json</code>に<code>"type": "module"</code>を加えます。</p>
</li>
<li><p><code>tsconfig.json</code>の<code>compilerOptions.module</code>を<code>"NodeNext"</code>にします。</p>
</li>
<li><p><code>tsconfig.json</code>の<code>ts-node</code>を次のようにします。</p>
</li>
</ul>
<pre><code>{
  ...
  "ts-node": {
    "esm": true,
    "require": ["tsconfig-paths/register"]
  },
  ...
}
</code></pre>
<ul>
<li><p><a class="Link" href="https://github.com/dividab/tsconfig-paths">tsconfig-paths</a>をインストールします。
(しない場合、<code>CustomError: Cannot find module</code>のエラーが発生します。)</p>
</li>
<li><p>importする際にpathに<code>.js</code>を付けます。
(例: <code>import { createTitle } from './utils.js'</code>)</p>
</li>
<li><p><code>package.json</code>に下記のような処理を実行する設定を追加します。</p>
</li>
</ul>
<pre><code class="language-json">{
  ...
  "scripts": {
    "execute": "ts-node scripts/index.ts"
  },
  ...
}
</code></pre>
<p><a class="Link" href="https://typestrong.org/ts-node/docs/imports#native-ecmascript-modules">Native ECMAScript modules</a><br><a class="Link" href="https://typestrong.org/ts-node/docs/paths/">paths and baseUrl</a></p>
<h3 id="tsconfig.jsonの例"><a href="#tsconfig.jsonの例">tsconfig.jsonの例</a></h3>
<pre><code class="language-json">{
    "compilerOptions": {
      "target": "ESNext",
      "module": "NodeNext",
      "allowJs": true,
      "strict": true,
      "moduleResolution": "NodeNext",
      "esModuleInterop": true,
      "baseUrl": "./",
      "skipLibCheck": true,
      "typeRoots": ["node_modules/@types"],
      "sourceMap": false
    },
    "ts-node": {
      "esm": true,
      "require": ["tsconfig-paths/register"]
    },
    "include": [
      "./scripts/**/*"
    ]
}
</code></pre>
<h2 id="ESLint"><a href="#ESLint">ESLint</a></h2>
<p><a class="Link" href="https://typescript-eslint.io/">typescript-eslint</a>を使います。設定ファイルの拡張子を<code>.cjs</code>にします。(例: <code>.eslintrc.cjs</code>)
これをしない場合、<code>Error [ERR_REQUIRE_ESM]</code>が発生します。</p>
<h2 id="Jest"><a href="#Jest">Jest</a></h2>
<p><a class="Link" href="https://kulshekhar.github.io/ts-jest/">ts-jest</a>を使います。
設定ファイルは<a class="Link" href="https://kulshekhar.github.io/ts-jest/docs/guides/esm-support#manual-configuration">これ</a>を参考にします。
設定ファイルの拡張子を<code>.cjs</code>にします。(例: <code>jest.config.cjs</code>)</p>
<h3 id="jest.config.cjsの例"><a href="#jest.config.cjsの例">jest.config.cjsの例</a></h3>
<pre><code class="language-js">module.exports = {
  roots: ['&lt;rootDir&gt;/scripts'],
  testMatch: ['**/*.test.ts'],
  extensionsToTreatAsEsm: ['.ts'],
  moduleNameMapper: {
    '^(\\.{1,2}/.*)\\.js$': '$1',
  },
  transform: {
    '^.+\\.tsx?$': [
      'ts-jest',
      {
        useESM: true,
      },
    ],
  },
}
</code></pre>
<h2 id="VSCode"><a href="#VSCode">VSCode</a></h2>
<p>VSCodeでdebugするには<code>.vscode/launch.json</code>の<a class="Link" href="https://code.visualstudio.com/docs/nodejs/nodejs-debugging#_launch-configuration-attributes">runtimeExecutable</a>に<code>${workspaceFolder}/node_modules/.bin/ts-node</code>をセットします。</p>
<h3 id=".vscode_launch.jsonの例"><a href="#.vscode_launch.jsonの例">.vscode/launch.jsonの例</a></h3>
<pre><code class="language-json">{
    "version": "2.0.0",
    "configurations": [
        {
            "name": "ts-node",
            "type": "node",
            "request": "launch",
            "runtimeExecutable": "${workspaceFolder}/node_modules/.bin/ts-node",
            "args": [
                "${workspaceFolder}/scripts/index.ts"
            ]
        }
    ]
}
</code></pre>

    </main>
    <div class="right-side"><div class="header-list"><p class="h1"><a href="#ts-nodeでESModulesを使う方法">ts-nodeでESModulesを使う方法</a></p>
<p class="h2"><a href="#設定">設定</a></p>
<p class="h3"><a href="#tsconfig.jsonの例">tsconfig.jsonの例</a></p>
<p class="h2"><a href="#ESLint">ESLint</a></p>
<p class="h2"><a href="#Jest">Jest</a></p>
<p class="h3"><a href="#jest.config.cjsの例">jest.config.cjsの例</a></p>
<p class="h2"><a href="#VSCode">VSCode</a></p>
<p class="h3"><a href="#.vscode_launch.jsonの例">.vscode/launch.jsonの例</a></p></div></div>
    <footer class="footer markdown-body">
      <a href="/tips">Top</a>
    </footer>
  </body>
</html>